
# Тестирование Event-Driven архитектуры с использованием Apache Kafka

![kafka_allure_result.png](https://github.com/Ewerall/QA-Portfolio/blob/main/Auto-testing/Kafka-Tests/kafka_allure_result.png "kafka_allure_result.png")

Эта папка включает в себя набор интеграционных автотестов для проверки корректности работы event-driven архитектуры на основе Apache Kafka. Тесты направлены на валидацию сценариев обмена сообщениями в распределенной системе, что критически важно для надежности микросервисной архитектуры.

## Применяемые технологии и инструменты

-   **Apache Kafka** - распределенная потоковая платформа для обработки потоковых данных в реальном времени ([Подробнее](https://github.com/Ewerall/QA-Portfolio/tree/main/Infrastructure/Kafka-Docker "Kafka-Docker") о настройке Apache Kafka через Docker)
-   **pytest** - фреймворк для написания тестов с возможностью гибкой настройки
-   **Allure Framework** - инструмент для создания наглядных отчетов о тестировании
-   **kafka-python** - клиентская библиотека для взаимодействия с Kafka
-   **JSON** - формат сериализации данных для передачи сообщений

## Реализованные тестовые сценарии

### 1. Проверка доставки события создания заказа

**Цель теста:** Валидация корректной передачи бизнес-события о создании заказа через Kafka.

**Особенности:**

-   Тест проверяет полный цикл: отправка события → получение события → верификация содержимого
-   Используется структурированный JSON-объект с реалистичными данными заказа
-   Реализован механизм ожидания с таймаутом (15 секунд), предотвращающий зависание теста
-   Тестовые данные включают сложную структуру с вложенными объектами (список товаров)

**Значимость:** Данный тест гарантирует, что критически важные бизнес-события корректно передаются между микросервисами, что необходимо для поддержания целостности бизнес-процессов.

### 2. Проверка пропускной способности системы

**Цель теста:** Оценка производительности Kafka при обработке большого объема сообщений.

**Особенности:**

-   Тест имитирует нагрузку отправкой 100 сообщений
-   Реализована групповая обработка сообщений (max_records=100)
-   Внедрен механизм подсчета полученных сообщений с контролем полноты доставки
-   Динамическое формирование group_id для изоляции тестовой нагрузки
-   Таймаут ожидания (30 секунд) предотвращает бесконечное ожидание

**Значимость:** Позволяет оценить способность системы обрабатывать пиковые нагрузки, что критично для планирования масштабирования и обеспечения отказоустойчивости.

## Подход к тестированию

### Структура тестов

-   Использована объектно-ориентированная структура с классом тестов
-   Четкое разделение на методы, соответствующие конкретным сценариям
-   Параметризация через фикстуры pytest (producer, order_consumer)

### Документирование тестов

-   Применена система аннотаций Allure с четкой иерархией:
    -   Epic: "Интеграционное тестирование Кафка"
    -   Feature: "Event-Driven архитектура"
    -   Story: Конкретный пользовательский сценарий
    -   Title: Подробное описание проверки
-   Шаги тестов детально задокументированы с помощью `with allure.step()`

### Утилиты для работы с Kafka

-   Созданы специализированные вспомогательные функции:
    -   `create_producer()` и `create_consumer()` - инкапсуляция настроек подключения
    -   `send_event()` и `consume_event()` - упрощение основных операций
-   Реализована JSON-сериализация/десериализация для передачи структурированных данных
-   Добавлены механизмы обработки таймаутов и проверки доставки

## Значение проекта

Этот набор тестов решает несколько задач в QA:

1.  **Обеспечение надежности интеграции** - гарантирует, что микросервисы корректно обмениваются данными
    
2.  **Раннее выявление проблем** - обнаруживание ошибок в обработке событий еще на этапе разработки
    
3.  **Верификация производительности** - дает количественные показатели пропускной способности системы
    
4.  **Документирование поведения системы** - тесты служат живой документацией по взаимодействию компонентов
    
5.  **Поддержка CI** - автоматизированные проверки легко интегрируются в процесс CI/CD
    

Такой подход к тестированию event-driven архитектур критически важен для распределенных систем, где надежность обмена сообщениями напрямую влияет на качество предоставляемых сервисов
